

MAINSOURCE := main.cpp test/client.cpp

SOURCE :=$(wildcard *.cpp test/*.cpp)

override SOURCE:=$(filter-out $(MAINSOURCE),$(SOURCE))
OBJS:=$(patsubst %.cpp,%.o,$(SOURCE))

TARGET:=miniweb
CC:=g++
LIBS:=-lpthread

CFLAGS:=-std=c++11 -g -Wall -O3 -D_PTHREADS
CXXFLAGS:=$(CFLAGS)

# test obj
SUBTARGET:=client

.PHONY: objs clean veryclean rebuild all tests debug
all: $(TARGET) $(SUBTARGET)
objs:$(OBJS)
rebuild: veryclean all

test:$(SUBTARGET)
clean:
	find . -name '*.o' | xargs rm -f
	
veryclean:
	find . -name '*.o' | xargs rm -f
	find . -name $(TARGET) | xargs rm -f
	find . -name $(SUBTARGET) | xargs rm -f

$(TARGET) : $(OBJS) main.o
	$(CC) $(CXXFLAGS) -o $@ $< $(LDFLAGS)
	
$(SUBTARGET):$(OBJS) test/client.o
	$(CC) $(CXXFLAGS) -o $@ $< $(LDFLAGS)

